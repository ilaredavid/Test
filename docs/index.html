<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Rules taxonomy – interactive database</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 2rem;
      max-width: 1200px;
    }
    table.dataTable tbody td {
      white-space: normal;
      word-break: break-word;
    }
    table.dataTable.stripe tbody tr:nth-child(odd) {
      background-color: #f7f7f7;
    }
    table.dataTable thead th {
      position: sticky;
      top: 0;
      background: #ffffff;
      z-index: 1;
    }
  </style>
</head>
<body>
  <h1>Taxonomy V4</h1>
  <p>
    Search, sort and filter all the content included in the version 4.  
    You can download the raw CSV file from
    <a href="rules_taxonomy_v4.csv">here</a>.
  </p>

  <table id="rules-table" class="display" style="width:100%">
    <thead>
      <tr id="rules-header-row"></tr>
    </thead>
    <tbody id="rules-body">
      <!-- Filled by JavaScript -->
    </tbody>
  </table>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <!-- Read CSV files -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const csvUrl = 'rules_taxonomy_v4.csv';
  
    fetch(csvUrl)
      .then(response => response.arrayBuffer())
      .then(buffer => {
        const decoder = new TextDecoder("utf-8");
        const csvText = decoder.decode(buffer);
        return csvText;
       }) 
      .then(csvText => {
        const parsed = Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true
        });
  
        const fields = parsed.meta.fields;
        const data = parsed.data;
  
        // Build header
        const headerRow = document.getElementById('rules-header-row');
        fields.forEach(name => {
          const th = document.createElement('th');
          th.textContent = name;
          headerRow.appendChild(th);
        });
  
        // Fill table body
        const tbody = document.getElementById('rules-body');
        data.forEach(row => {
          const tr = document.createElement('tr');
          fields.forEach(name => {
            const td = document.createElement('td');
            td.textContent = row[name] ?? '';
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
  
        const thead = headerRow.parentElement;
  
        // ----------- CREATE FILTER ROW WITH MULTI-SELECTS -----------
        const filterRow = document.createElement('tr');
        filterRow.classList.add("filters");
  
        fields.forEach((field, colIdx) => {
          const th = document.createElement('th');
  
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "Filter…";
          input.classList.add("filter-input");

          th.appendChild(input);
          filterRow.appendChild(th);
        });
  
        thead.appendChild(filterRow);
  
        // ------------- INIT DATATABLES -------------------
  
        const table = $('#rules-table').DataTable({
          pageLength: 25,
          lengthMenu: [10, 25, 50, 100],
          order: [],
          scrollX: true,
          language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.8/i18n/en-US.json"
          }
        });
  
        // ----------- APPLY MULTI-SELECT FILTERS PER COLUMN --------------
  
        table.columns().every(function (colIdx) {
          const input = thead.querySelectorAll("tr.filters input")[colIdx];

          input.addEventListener("keyup", function () {
          table.column(colIdx).search(this.value).draw();
          });
        });
  
        // Escape regex helper
        function escapeRegex(str) {
          return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
      })
      .catch(error => {
        console.error(error);
        alert('Error loading table. Check console.');
      });
  </script>
</body>
</html>

