<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Rules taxonomy â€“ interactive database</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 2rem;
    }
    table.dataTable thead th {
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <h1>Rules taxonomy (interactive)</h1>
  <p>
    Search, sort and filter the taxonomy.  
    You can download the raw CSV file from
    <a href="rules_taxonomy_v4.csv">here</a>.
  </p>

  <table id="rules-table" class="display" style="width:100%">
    <thead>
      <tr id="rules-header-row"></tr>
    </thead>
    <tbody id="rules-body">
      <!-- Filled by JavaScript -->
    </tbody>
  </table>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <!-- Read CSV files -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    // Path to CSV
    const csvUrl = 'data/rules_taxonomy_v4.csv';

    fetch(csvUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error('Error loading CSV: ' + response.status);
        }
        return response.text();
      })
      .then(csvText => {
        const parsed = Papa.parse(csvText, {
          header: true,        // primera fila como cabecera
          skipEmptyLines: true
        });

        const fields = parsed.meta.fields; // nombres de columnas
        const data = parsed.data;          // array de objetos: {col1: ..., col2: ...}

        // Build a header
        const headerRow = document.getElementById('rules-header-row');
        fields.forEach(name => {
          const th = document.createElement('th');
          th.textContent = name;
          headerRow.appendChild(th);
        });

        // Build a body with tables
        const tbody = document.getElementById('rules-body');
        data.forEach(row => {
          const tr = document.createElement('tr');
          fields.forEach(name => {
            const td = document.createElement('td');
            td.textContent = row[name] ?? '';
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        // If the table is already built, activate DataTables
        $('#rules-table').DataTable({
          pageLength: 25,
          lengthMenu: [10, 25, 50, 100],
          order: [] // No initial order by default
        });
      })
      .catch(error => {
        console.error(error);
        alert('There was a problem loading the data table. Check the console for details.');
      });
  </script>
</body>
</html>
